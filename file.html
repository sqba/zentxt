<html>
    <body>
        <link rel="stylesheet" href="css/overcast/jquery-ui-1.8.17.custom.css">

        <style type="text/css">
            body {
                font-size: 62.5%;
            }
        </style>

        <script src="js/jquery-1.7.1.js"></script>
        <script src="js/jquery-ui-1.8.17.custom.min.js"></script>
        <script>
            $(function() {
                $( "#accordion" ).accordion({
                    autoHeight: false,
                    //navigation: true,
                    //collapsible: true
                });
            });

            function OnChangeStart(event, ui) {
                var href = $(ui.newHeader.find("a")).attr("href");
                if("#" != href) {
                    divobj = ui.newContent.find('.child');
                    //console.log("html: " + divobj.html());
                    if(divobj.html() == "") {
                        $.get(href, function(data) {
                            //ui.newContent.find("div").html("<pre>" + data + "</pre>" + html);
                            divobj.html("<pre>" + data + "</pre>");
                        });
                    }
                }
            }

            $(function() {
                $("#accordion").accordion({
                  changestart: OnChangeStart
                });
            });

            $.ctrl = function(key, callback, args) {
                var isCtrl = false;
                $(document).keydown(function(e) {
                    if(!args) args=[]; // IE barks when args is null

                    if(e.ctrlKey) isCtrl = true;
                    if(e.keyCode == key.charCodeAt(0) && isCtrl) {
                        callback.apply(this, args);
                        return false;
                    }
                }).keyup(function(e) {
                    if(e.ctrlKey) isCtrl = false;
                });
            };

            $.ctrl('S', function() {
                document.forms["save"].submit();
            });

        </script>

		<div id="guser" style="padding: 0pt 0pt 4px; font-size: 84%;" width="100%" align="right">
			<nobr>
				<b>{{ user }}</b>
			</nobr>
		</div>

        <div id="accordion" class="ui-accordion ui-widget ui-helper-reset">
            <h3 class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-top">
            <a href="#">Edit</a>
        </h3>

        <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom">
            <p>
                <form id="save" action="/save" method="post">
                    <input type="hidden" name="id" value="{{ file_id }}">
                    <div>
                        <textarea name="content" rows="30" style="width:100%">{{ file_text }}</textarea>
                    </div>
                    <div align="right"><input type="submit" value="Save"></div>
                </form>
            </p>
        </div>

        {% for revision in revisions %}
            <h3 class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-top">
                <a href="rev?id={{ revision.key }}">{{ revision.date|date:"l, F d Y, h:m:s" }} by {{ revision.author }}</a>
            </h3>
            <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom">
                <div class="child"></div>
                <form id="revert" action="/revert" method="post">
                    <input type="hidden" name="id" value="{{ revision.key }}">
                    <div align="right"><input type="submit" value="Revert"></div>
                </form>
            </div>
        {% endfor %}

    </body>
</html>
