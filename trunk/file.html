<html>
    <body>
        <link rel="stylesheet" href="css/overcast/jquery-ui-1.8.17.custom.css">
        <style type="text/css">
body {
    font-size: 62.5%;
}
        </style>

        <script src="js/jquery-1.7.1.js"></script>
        <script src="js/jquery-ui-1.8.17.custom.min.js"></script>
        <script>
	$(function() {
		$( "#accordion" ).accordion({
			autoHeight: false,
			//navigation: true,
            //collapsible: true
		});
	});
//http://stackoverflow.com/questions/646415/jquery-accordion-and-loading-content-through-ajax
  function OnChange(event, ui) {
    //var active = $("#accordion").accordion('option','active')
    //console.log("Selected item: " + active );
  }

  function OnChangeStart(event, ui) {
	var href = $(ui.newHeader.find("a")).attr("href");
    if("#" == href)
        return;
	//console.log(href);
	//ui.newContent.html("test");
	
	//href = "localhost:8081"
    console.log(ui.newContent.html());
    if(ui.newContent.html() != "")
        return;
	$.post(href, function(data) {
		//console.log(href);
		ui.newHeader.next("div").html("<pre>" + data + "</pre>");
	});

	//ui.newHeader.next("div").html("http://www.google.com");
	//ui.newContent.innerHMTL = "test";
	//console.log(ui.newContent.html());
        //if(ui.newContent.html()!=""){
	        //ui.newContent.load("http://www.google.com");
        //}
  }

  $(function() {
    
    $("#accordion").accordion({
      change : OnChange,
      changestart: OnChangeStart
    });
    
  });

$.ctrl = function(key, callback, args) {
    var isCtrl = false;
    $(document).keydown(function(e) {
        if(!args) args=[]; // IE barks when args is null

        if(e.ctrlKey) isCtrl = true;
        if(e.keyCode == key.charCodeAt(0) && isCtrl) {
            callback.apply(this, args);
            return false;
        }
    }).keyup(function(e) {
        if(e.ctrlKey) isCtrl = false;
    });
};

$.ctrl('S', function() {
    document.forms["save"].submit();
});

        </script>

		<div id="guser" style="padding: 0pt 0pt 4px; font-size: 84%;" width="100%" align="right">
			<nobr>
				<b>{{ user }}</b>
			</nobr>
		</div>


        <div id="accordion" class="ui-accordion ui-widget ui-helper-reset">
         <h3 class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-top">
            <a href="#">Edit</a>
        </h3>
        <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom">
            <p>
                <form id="save" action="/save" method="post">
                    <input type="hidden" name="file_id" value="{{ file_id }}">
                    <div>
			<textarea name="content" rows="30" style="width:100%">{{ last_text }}</textarea>
		    </div>
                    <div align="right"><input type="submit" value="Save"></div>
                </form>
            </p>
        </div>
       {% for revision in revisions %}
            <h3 class="ui-accordion-header ui-helper-reset ui-state-active ui-corner-top">
                <a href="rev?rev_id={{ revision.key }}">{{ revision.date|date:"l, F d Y, h:m:s" }}</a>
            </h3>
            <div class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom"></div>
        {% endfor %}
</body>
</html>
